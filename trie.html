<!DOCTYPE html>
<html>
    <head>
        <title>Trie Search</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <style>
        body {
            font: 10pt Arial, sans-serif;
        }
        </style>
    </head>
    <body>
        <h1>Trie Search</h1>

        <p>This is a test to compare searches with a "trie" data structure against a "regular" for loop search on over 35,000 city names.</p>

        <table border="0" cellpadding="3" cellspacing="3">
            <tr>
                <th>Trie</th>
                <th>Regular</th>
            </tr>
            <tr>
                <td><input type="text" name="citySearch" value="" size="50" placeholder="Search for a city (e.g., Tor)" onkeyup="searchData(this);"></td>
                <td><input type="text" name="citySearchRegular" value="" size="50" placeholder="Search for a city (e.g., Tor)" onkeyup="searchDataRegular(this);"></td>
            </tr>
            <tr>
                <td><div id="results" onclick="selectCity(this, event);"></div></td>
                <td><div id="resultsRegular" onclick="selectCity(this, event);"></div></td>
            </tr>
        </table>

        <script src="dat/citynames.js"></script>
        <script src="lib/trie-min.js"></script>
        <script>
        var T = new Trie();

        function loadData () {
            //console.time('loadData');
            var startTime = new Date();

            for(var i = 0, ii = cityNames.length; i < ii; i++) {
                T.insert(cityNames[i]);
            }

            var elapsedTime = new Date() - startTime;
            alert('Inserted ' + cityNames.length + ' cities in ' + elapsedTime + ' ms.');
            //console.timeEnd('loadData');
        }

        function searchData (elem) {
            var startTime = new Date(),
                matches = T.autoComplete(elem.value);
                html = '';

            if (elem.value.length > 0) {
                if (matches.length > 0) {
                    var fields,
                        //max = (matches.length > 10) ? 10 : matches.length,
                        max = 10,
                        html = '<select id="resultsList" name="" size="' + max + '">',
                        opt = '';

                    for (var i = 0; i < matches.length; i++) {
                        fields = matches[i].split(",");
                        opt = '<option value="' + fields[3] + ', ' + fields[4] + '">' + fields[0] + ', ' + fields[1] + ', ' + fields[2] + '</option>';
                        html += opt;
                    }

                    var elapsedTime = new Date() - startTime;

                    html += '</select>';
                    html += '<div>Found ' + matches.length + ' matches in <b>' + elapsedTime + ' ms</b></div>';
                }
                else {
                    html += '<div>No matches</div>';
                }
            }

            document.getElementById('results').innerHTML = html;
            toggleList('results', 'block');
        }

        function searchDataRegular (elem) {
            var startTime = new Date(),
                patt = new RegExp("^" + elem.value),
                matches = 0,
                max = 10,
                html = '';

            html = '<select id="resultsList" name="" size="' + max + '">';

            for (var i = 0, ii = cityNames.length; i < ii; i++) {
                if (cityNames[i].match(patt)) {
                    fields = cityNames[i].split(",");
                    opt = '<option value="' + fields[3] + ', ' + fields[4] + '">' + fields[0] + ', ' + fields[1] + ', ' + fields[2] + '</option>';
                    html += opt;
                    matches++;
                }
            }

            var elapsedTime = new Date() - startTime;

            html += '</select>';
            html += '<div>Found ' + matches + ' matches in <b>' + elapsedTime + ' ms</b></div>';

            document.getElementById('resultsRegular').innerHTML = html;
            toggleList('resultsRegular', 'block');
        }

        function toggleList (divId, state) {
            document.getElementById(divId).style.display = state;
        }

        function selectCity (elem, evt) {
            if (evt.target.parentElement.id == "resultsList") {
                //console.log(evt, evt.target.innerHTML, evt.target.value);
                document.getElementById('results').style.display = 'none';
                alert(evt.target.value);
            }
        }

        loadData();
        </script>
    </body>
</html>
